<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>AskRAG Demo</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 40px;
    }
    textarea, input {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-top: 6px;
      resize: vertical;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      background: #0078ff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #005fcc;
    }
    pre {
      background: #eee;
      padding: 12px;
      border-radius: 6px;
      overflow-x: auto;
    }
    .result-box {
      margin-top: 20px;
      padding: 15px;
      background: #fafafa;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    .answer {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
  <div class="container">

    <h1>AskRAG Demo</h1>
    <p>ã“ã®ç”»é¢ã§ã¯ã€RAG ã‚·ã‚¹ãƒ†ãƒ ã® <b>ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç™»éŒ²ï¼ˆIngestï¼‰</b> ã¨ <b>è³ªå•å¿œç­”ï¼ˆQueryï¼‰</b> ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ä½“é¨“ã§ãã¾ã™ã€‚</p>

    <!-- Ingest Section -->
    <h2>ğŸ“¥ Ingest APIï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç™»éŒ²ï¼‰</h2>
    <p>Knowledge Base ã«ç™»éŒ²ã—ãŸã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>

    <label><b>ãƒ†ã‚­ã‚¹ãƒˆå†…å®¹</b></label>
    <textarea id="ingestText" placeholder="ç™»éŒ²ã™ã‚‹æ–‡ç« ã‚’å…¥åŠ›"></textarea>

    <label><b>Metadataï¼ˆä»»æ„ï¼‰</b></label>
    <input id="ingestSource" placeholder='sourceï¼ˆä¾‹: "demo"ï¼‰' />
    <input id="ingestCategory" placeholder='categoryï¼ˆä¾‹: "test"ï¼‰' />

    <button onclick="callIngest()">Ingest API ã‚’å®Ÿè¡Œ</button>

    <div id="ingestResult" class="result-box"></div>

    <!-- Query Section -->
    <h2>ğŸ” Query APIï¼ˆè³ªå•å¿œç­”ï¼‰</h2>
    <p>ç™»éŒ²æ¸ˆã¿ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¤œç´¢ã—ã€LLM ãŒå›ç­”ã‚’ç”Ÿæˆã—ã¾ã™ã€‚</p>

    <textarea id="queryInput" placeholder="ä¾‹: ä¼šç¤¾æ¦‚è¦ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚"></textarea>
    <button onclick="callQuery()">Query API ã‚’å®Ÿè¡Œ</button>

    <div id="queryResult" class="result-box"></div>

  </div>

  <script>
    const endpointIngest = "https://w17e5we33a.execute-api.ap-northeast-1.amazonaws.com/Prod/ingest";
    const endpointQuery  = "https://w17e5we33a.execute-api.ap-northeast-1.amazonaws.com/Prod/query";

    // -------------------------------
    // Ingest API
    // -------------------------------
    async function callIngest() {
      const text = document.getElementById("ingestText").value;
      const source = document.getElementById("ingestSource").value || "demo";
      const category = document.getElementById("ingestCategory").value || "test";

      if (!text) {
        alert("ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      const body = {
        text: text,
        metadata: {
          source: source,
          category: category
        }
      };

      document.getElementById("ingestResult").innerHTML = "å®Ÿè¡Œä¸­...";

      const res = await fetch(endpointIngest, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      const data = await res.json();

      document.getElementById("ingestResult").innerHTML = `
        <div><b>ğŸ“„ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç™»éŒ²å®Œäº†</b></div>
        <pre>${JSON.stringify(data, null, 2)}</pre>
        <p style="color:#555;">â€» KB ã®åŒæœŸã«ã¯æ•°åç§’ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</p>
      `;
    }

    // -------------------------------
    // Query API
    // -------------------------------
    async function callQuery() {
      const query = document.getElementById("queryInput").value;

      if (!query) {
        alert("è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        return;
      }

      const body = { query: query };

      document.getElementById("queryResult").innerHTML = "å®Ÿè¡Œä¸­...";

      const res = await fetch(endpointQuery, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });

      const data = await res.json();

      document.getElementById("queryResult").innerHTML = `
        <div class="answer">ğŸ’¬ å›ç­”:<br>${data.answer}</div>
        <b>Contextï¼ˆå‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰</b>
        <pre>${JSON.stringify(data.context, null, 2)}</pre>
        <b>Raw JSON</b>
        <pre>${JSON.stringify(data, null, 2)}</pre>
      `;
    }
  </script>
</body>
</html>
